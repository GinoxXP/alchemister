using Ginox.BlackCauldron.Core.Editor;
using System;
using UnityEditor;
using UnityEngine;

namespace Ginox.BlackCauldron.Alchemy.Editor
{
    public class CreateIngredientWindow : EditorWindow
    {
        private static readonly string ALCHEMY_PATH = Environment.CurrentDirectory + "\\" + "Assets\\Black Cauldron\\Alchemy\\Scripts\\";
        private static readonly string INGREDIENTS_PATH = "Ingredients\\";
        private static readonly string MODELS_PATH = ALCHEMY_PATH + "Models\\" + INGREDIENTS_PATH;
        private static readonly string VIEWS_PATH = ALCHEMY_PATH + "Views\\" + INGREDIENTS_PATH;
        private static readonly string VIEW_MODELS_PATH = ALCHEMY_PATH + "ViewModels\\" + INGREDIENTS_PATH;

        private string ingredientName;

        [MenuItem("Code Generation/Create ingredient")]
        static void ShowWindow()
        {
            GetWindow<CreateIngredientWindow>("Create ingredient");
        }

        private void OnGUI()
        {
            ingredientName = GUILayout.TextField(ingredientName);
            if (GUILayout.Button("Create"))
                Generate(ingredientName);
        }

        public void Generate(string ingredientName)
        {
            var ingredient = ParseName.Parse(ingredientName);

            var modelClassName = ingredient;
            var viewClassName = $"{ingredient}View";
            var viewModelClassName = $"{ingredient}ViewModel";

            var model =
$@"//<auto-generated/>
namespace Ginox.BlackCauldron.Alchemy.Models.Ingredients
{{
    public class {modelClassName} : AIngredient
    {{
        public override string NameKey => nameof({ingredient});
    }}
}}
";

            var view =
$@"//<auto-generated/>
using Ginox.BlackCauldron.Alchemy.ViewModels.Ingredients;
using Zenject;

namespace Ginox.BlackCauldron.Alchemy.Views.Ingredients
{{
    public class {viewClassName} : AIngredientView
    {{
        [Inject]
        private void Init({viewModelClassName} viewModel)
        {{
            base.Init(viewModel);
        }}
    }}
}}
";

            var controller =
$@"//<auto-generated/>
using Ginox.BlackCauldron.Alchemy.Models.Ingredients;

namespace Ginox.BlackCauldron.Alchemy.ViewModels.Ingredients
{{
    public class {viewModelClassName} : AIngredientViewModel
    {{
        public {viewModelClassName}({modelClassName} model) : base(model)
        {{
        }}
    }}
}}
";

            ClassFile.SaveClassFile(modelClassName, MODELS_PATH, model);
            ClassFile.SaveClassFile(viewClassName, VIEWS_PATH, view);
            ClassFile.SaveClassFile(viewModelClassName, VIEW_MODELS_PATH, controller);

            Debug.Log($"{ingredient} was created");
        }
    }
}
